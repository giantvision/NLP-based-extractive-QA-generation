# 题库的Django后端说明文档--0.4

时间：2022-05-09

主要的更新内容：

1. 添加基于WantWords的错误答案生成功能的说明

   


## **前端的产品交互逻辑设计：**

核心点：

- 挑选出有效的题目并放到新表格中，对旧表中的已查阅题目进行整个删除(补充说明：旧表直接删除的是MongoDB的分段collections)

则只需要编写两个主要的交互程序：

1. 把选中的题目放到相应领域的表中；
2. 把已经查阅完毕的旧表中的数据进行删除；

### <span style='color:brown'>**命名说明**</span>

- db_name--所选择的表明
  - 此处只有两张表：
    - db_test：旧表，里面存有所有的待筛选的题目
- col_name--域标签
  - 功能说明：
    - 根据域分类，选择不同的题目类型

### <span style='color:brown'>**主要URL说明**</span>

目录表：

1. col_tree
2. col_docs
3. insert_data
4. update_part
5. replace_many
6. delete_many
7. delete_col
8. delete_db
9. download_col
10. download_db
11. create_db
12. get_db_list
13. db_count
14. col_count
15. search_aggregate
16. choose_wrong_answers
17. WantWords
18. delete_was





**请求方式**

*   POST

1. col_tree

   - 功能说明：

     - 根据请求的db_name，从MongoDB中返回后端事前分类的此表中的所有子表；

   - 请求参数

     | 参数名  | 必选 |  类型  | 默认值 |         说明          |
     | :-----: | :--: | :----: | :----: | :-------------------: |
     | db_name |  Y   | String |   \    | 对应mongodb的database |

     - table_name

       说明：test为待筛选的旧表格，new_db为用户筛选的表格，后续更新为根据用户新建名展示的表格名；

   - 返回值：

     |  参数名  |  类型  |                  说明                  |
     | :------: | :----: | :------------------------------------: |
     |   code   | number |               返回状态码               |
     | col_tree |  List  | col_tree={'title':db_name, 'children'} |

     

     - 根据策划给出的标签划分、再根据mongoDB的表格中获取的collections进行分类返回给前端进行显示
     - 根据信息源进行分类
       1. 自然科学
          - kg_sci_list、wiki_sci_list、human_sci_list
       2. 生活常识
          - kg_life_list、wiki_life_list、human_life_list
       3. 传统文化
          - kg_cul_list、wiki_cul_list、human_cul_list

- 说明：该方法为获得多级目录的关系，其中的关系由后端写死，如果后续有改动则需要更新后端信息；

2. col_docs

   - 功能说明

     - 根据需要查询的题库及域标签选择题目类型

   - 请求参数

     |  参数名  | 必选 |  类型  | 默认值 |          说明           |
     | :------: | :--: | :----: | :----: | :---------------------: |
     | db_name  |  Y   | String |   \    |  对应mongodb的database  |
     | col_name |  Y   | String |   \    | 对应mongodb的collection |

   - 返回值

     | 参数名 | 类型 |   说明   |
     | :----: | :--: | :------: |
     |  data  | List | 返回内容 |

     

3. insert_data

   - 功能说明

     - 将前端挑选好的题目加入到对应的新表中

   - 请求参数

     |  参数名  | 必选 |  类型  | 默认值 |      说明      |
     | :------: | :--: | :----: | :----: | :------------: |
     | db_name  |  Y   | String |   \    |       \        |
     | col_name |  Y   | String |   \    |       \        |
     |   data   |  Y   |  List  |   \    | 需要插入的数据 |

   - 返回值

     | 参数名  |  类型  |     说明     |
     | :-----: | :----: | :----------: |
     | message | String | 插入成功说明 |

     

4. update_part

   - 功能说明

     - 更新部分数据：应用场景--前端对部分数据进行改写，然后即时进行更新

   - 请求参数

     |   参数名   | 必选 |  类型  | 默认值 |   说明   |
     | :--------: | :--: | :----: | :----: | :------: |
     |  db_name   |  Y   | String |   \    |    \     |
     |  col_name  |  Y   | String |   \    |    \     |
     |    data    |  Y   | String |   \    |    \     |
     | field_spec |  Y   | String |   \    | text/q/a |

   - 返回值

     | 参数名  |  类型  |     说明     |
     | :-----: | :----: | :----------: |
     | message | String | 更新成功说明 |

5. replace_many

   - 功能说明

     - 更新部分数据：应用场景--前端对部分数据进行改写，然后即时进行更新

   - 请求参数

     |  参数名  | 必选 |  类型  | 默认值 |      说明      |
     | :------: | :--: | :----: | :----: | :------------: |
     | db_name  |  Y   | String |   \    |       \        |
     | col_name |  Y   | String |   \    |       \        |
     |   data   |  Y   |  List  |   \    | 需要更新的数据 |

   - 返回值

     | 参数名  |  类型  |     说明     |
     | :-----: | :----: | :----------: |
     | message | String | 替换成功说明 |

     

6. delete_many

   - 功能说明

     - 删除不想要的词条数据

   - 请求参数

     |  参数名  | 必选 |  类型  | 默认值 |      说明      |
     | :------: | :--: | :----: | :----: | :------------: |
     | db_name  |  Y   | String |   \    |       \        |
     | col_name |  Y   | String |   \    |       \        |
     |   data   |  Y   |  List  |   \    | 需要删除的数据 |

   - 返回值

     | 参数名  |  类型  |     说明     |
     | :-----: | :----: | :----------: |
     | message | String | 插入删除说明 |

7. delete_col

   - 功能说明

     - 删除不想要的数据子集

   - 请求参数

     |  参数名  | 必选 |  类型  | 默认值 | 说明 |
     | :------: | :--: | :----: | :----: | :--: |
     | db_name  |  Y   | String |   \    |  \   |
     | col_name |  Y   | String |   \    |  \   |

   - 返回值

     | 参数名  |  类型  |          说明           |
     | :-----: | :----: | :---------------------: |
     | message | String | 插入删除domain_data说明 |

8. download_col

   - 功能说明

     - 基于domain_label页下，用户所选择的标签域导出的文件、并进行Excel文件的下载

   - 请求参数

     |  参数名  | 必选 |  类型  | 默认值 | 说明 |
     | :------: | :--: | :----: | :----: | :--: |
     | db_name  |  Y   | String |   \    |  \   |
     | col_name |  Y   | String |   \    |  \   |

     

9. download_db

   - 功能说明

     - 基于table_name页下的所有domain_label进行数据下载

   - 请求参数

     | 参数名  | 必选 |  类型  | 默认值 | 说明 |
     | :-----: | :--: | :----: | :----: | :--: |
     | db_name |  Y   | String |   \    |  \   |

     

10. create_db

    - 功能说明
      - 给用户用于创建新表使用

- 请求参数

  |   参数名    | 必选 |  类型  | 默认值 | 说明 |
  | :---------: | :--: | :----: | :----: | :--: |
  | new_db_name |  Y   | String |   \    |  \   |

- 返回值

  | 参数名  |  类型  |       说明       |
  | :-----: | :----: | :--------------: |
  | message | String | 成功创建新表说明 |



11. get_db_list

    - 功能说明

      - 将用户为了筛选数据而新建的所有表名返还给前端

    - 请求参数

      - 无参数

    - 返回值

      |    参数名    | 类型 | 说明 |
      | :----------: | :--: | :--: |
      | user_db_list | List |  \   |

12. delete_db

    - 功能说明

      - 用户删除用户创建的table

    - 请求参数

      | 参数名  | 必选 |  类型  | 默认值 |     说明     |
      | :-----: | :--: | :----: | :----: | :----------: |
      | db_name |  Y   | String |   \    | 需删除的表名 |

     - 返回值

    | 参数名  |  类型  |     说明      |
    | :-----: | :----: | :-----------: |
    | message | String | 成功删除table |

      

13. db_count

    - 请求参数

      | 参数名  | 必选 |  类型  | 默认值 | 说明 |
      | :-----: | :--: | :----: | :----: | :--: |
      | db_name |  Y   | String |   \    |  \   |

    - 返回值

      |  参数名  | 类型 | 说明 |
      | :------: | :--: | :--: |
      | db_count | List |  \   |

14. col_count

    - 请求参数

      |  参数名   | 必选 |  类型  | 默认值 | 说明 |
      | :-------: | :--: | :----: | :----: | :--: |
      |  db_name  |  Y   | String |   \    |  \   |
      | col_label |  Y   | String |   \    |  \   |

    - 返回值


      |  参数名   | 类型 | 说明 |
      | :-------: | :--: | :--: |
      | col_count | Int  |  \   |

15. search_aggregate

    - 请求参数

      |  参数名  | 必选 |  类型  | 默认值 |    说明    |
      | :------: | :--: | :----: | :----: | :--------: |
      |  query   |  Y   | String |   \    | 要查询的词 |
      | db_name  |  Y   | String |   \    |     \      |
      | col_name |  Y   | String |   \    |     \      |

    - 返回值

      | 参数名  |         类型          |      说明      |
      | :-----: | :-------------------: | :------------: |
      | results | pymongo.cursor.Cursor | 查询返回的结果 |

16. choose_wrong_answers

    - 请求参数

      | 参数名 | 必选 |  类型  | 默认值 |                             说明                             |
      | :----: | :--: | :----: | :----: | :----------------------------------------------------------: |
      | query  |  Y   | String |   \    | 正确答案的相关词，一次查找到可选的近义词，从而作为错误答案使用 |

      

    - 返回值

      |     参数名     | 类型 |                 说明                 |
      | :------------: | :--: | :----------------------------------: |
      | answer_options | dict | {'title': title, 'answers': answers} |

17. WantWords

    - 请求参数

      |   参数名    | 必须 |  类型  | 默认值 |             说明             |
      | :---------: | :--: | :----: | :----: | :--------------------------: |
      | description |  Y   | String |   \    | 需要查询的答案(最好为单个词) |

      

    - 返回值

      | 参数名 | 类型 |                  说明                  |
      | :----: | :--: | :------------------------------------: |
      |  ret   | List | 返回十个与待查询答案最接近的10个相近词 |

18. delete_was

    - 功能说明：

- 删除不想要的错误答案选项

- 请求参数

      |  参数名  | 必须 |  类型  | 默认值 |        说明        |
      | :------: | :--: | :----: | :----: | :----------------: |
      | db_name  |  Y   | String |   \    |     数据库名称     |
      | col_name |  Y   | String |   \    |   collection名称   |
      |   _id    |  Y   |  int   |   \    |         \          |
      |   c_id   |  Y   |  int   |   \    |         \          |

  |   was    |  Y   | String |   \    | 需要删除的错误选项 |

  

   - 返回值

  | 参数名  |  类型  |       说明       |
  | :-----: | :----: | :--------------: |
  | message | String | 成功删除错误答案 |

19. sampling

    - 功能说明：对数据集进行随机采样100个，进行打分评估数据质量

    - 请求参数

      | 参数名  | 必须 |  类型  | 默认值 |        说明        |
      | :-----: | :--: | :----: | :----: | :----------------: |
      | db_name |  Y   | String |   \    | 需评估的数据集名称 |

      

    - 返回值

      | 参数名 | 类型 |                  说明                   |
      | :----: | :--: | :-------------------------------------: |
      |  data  | List | 返回100个抽样的数据并返回给前端进行评估 |

      

20. score_record

    - 对分数及抽样的题目数据进行记录，方便后续进行 Review
    
    - 请求参数
    
      |  参数名   | 必须 |  类型  | 默认值 |            说明            |
      | :-------: | :--: | :----: | :----: | :------------------------: |
      |   score   |  Y   | String |   \    |     前端计算得出的分数     |
      | evaluator |  Y   | String |   \    |           评估人           |
      |   data    |  Y   |  dict  |   \    | 将评分的分数及细节记录下来 |
    
      
    
    - 返回值
    
      | 参数名  |  类型  |     说明     |
      | :-----: | :----: | :----------: |
      | message | String | 返回纪录成功 |
    
21. query_score

    - 功能说明：

      - 将请求的 db_name 的所有的评分进行返回

    - 请求参数

      | 参数名  | 必须 |  类型  | 默认值 |     说明     |
      | :-----: | :--: | :----: | :----: | :----------: |
      | db_name |  Y   | String |   \    | 请求的数据名 |

    - 返回值

      | 参数名 | 类型 |           说明           |
      | :----: | :--: | :----------------------: |
      |  data  | List | 满足请求的所有评分数据集 |

22. score_review

    - 功能说明：

      - 对已有的评分进行Review--审查，方便数据分析、发现问题及调整

      |   参数名    | 必须 |  类型  | 默认值 |     说明     |
      | :---------: | :--: | :----: | :----: | :----------: |
      |   db_name   |  Y   | String |   \    | 请求的数据名 |
      |  evaluator  |  Y   | String |   \    |    评估者    |
      | create_time |  Y   | String |   \    |   新建时间   |

    - 返回值

      | 参数名 | 类型 |                说明                |
      | :----: | :--: | :--------------------------------: |
      |  data  | dict | 用户请求Review的数据集的评分及细节 |

      